import{l as e,r as a,j as t}from"./app-1a5829bc.js";const s=()=>{const{t:s}=e("en"),[o,d]=a.useState([]),[c,r]=a.useState([]),[m,h]=a.useState(!1),[u,p]=a.useState(""),[x,j]=a.useState(0),[y,g]=a.useState(!1),[f,v]=a.useState(!1),[b,S]=a.useState(null),k=a.useCallback(async()=>{h(!0);try{const e=await fetch("/.netlify/functions/list-images"),a=await e.json();d(a.map(e=>({key:e.key,url:`/.netlify/functions/get-image?key=${e.key}`,metadata:e.metadata})))}catch(e){}finally{h(!1)}},[]);a.useEffect(()=>{k()},[k]);const C=o.filter(e=>{var a;return e.key.toLowerCase().includes(u.toLowerCase())||(null==(a=e.metadata.altText)?void 0:a.toLowerCase().includes(u.toLowerCase()))});return t.jsxs("div",{className:"admin-container",style:{marginTop:"200px"},children:[t.jsxs("header",{className:"admin-header",children:[t.jsx("h1",{children:s("admin.title")}),t.jsx("div",{className:"search-box",children:t.jsx("input",{type:"text",placeholder:s("admin.search_placeholder"),value:u,onChange:e=>p(e.target.value)})})]}),t.jsxs("section",{className:"upload-section",children:[t.jsx(l,{onDrop:async e=>{g(!0),j(0);try{const a=new FormData;Array.from(e).forEach(e=>{a.append("files",e)});const t=new XMLHttpRequest;t.upload.onprogress=e=>{e.lengthComputable&&j(Math.round(e.loaded/e.total*100))},await new Promise((e,s)=>{t.onload=()=>e(t.responseText),t.onerror=()=>s(new Error("Upload failed")),t.open("POST","/.netlify/functions/upload",!0),t.send(a)}),await k()}catch(a){}finally{g(!1),j(0)}},disabled:y}),y&&t.jsxs("div",{className:"upload-progress",children:[t.jsx("progress",{value:x,max:"100"}),t.jsxs("span",{children:[x,"%"]})]})]}),t.jsxs("div",{className:"action-toolbar",children:[t.jsx("button",{onClick:async()=>{if(c.length)try{await Promise.all(c.map(e=>fetch("/.netlify/functions/delete-image",{method:"POST",body:JSON.stringify({key:e}),headers:{"Content-Type":"application/json"}}))),r([]),await k()}catch(e){}},disabled:!c.length,children:s("admin.delete_selected")}),t.jsxs("span",{children:[c.length," ",s("admin.selected_items")]})]}),t.jsx("section",{className:"gallery-section",children:m?t.jsx("div",{className:"loading-indicator",children:s("admin.loading")}):t.jsx("div",{className:"image-grid",children:C.map(e=>t.jsx("div",{children:t.jsx(i,{blob:e,isSelected:c.includes(e.key),onSelect:a=>{r(t=>a?[...t,e.key]:t.filter(a=>a!==e.key))},onEdit:()=>(e=>{S(e),v(!0)})(e)})},e.key))})}),f&&b&&t.jsx(n,{blob:b,onClose:()=>v(!1),onSave:async e=>{try{await fetch("/.netlify/functions/update-metadata",{method:"POST",body:JSON.stringify({key:e.key,metadata:e.metadata}),headers:{"Content-Type":"application/json"}}),v(!1),await k()}catch(a){}}})]})},l=({onDrop:e,disabled:a})=>t.jsxs("div",{className:"file-dropzone",children:[t.jsx("input",{type:"file",multiple:!0,onChange:a=>a.target.files&&e(a.target.files),disabled:a}),t.jsx("p",{children:a?"上传中...":"拖放文件到这里或点击选择文件"})]}),n=({blob:e,onClose:s,onSave:l})=>{var n;const[i,o]=a.useState(e.metadata.altText||""),[d,c]=a.useState((null==(n=e.metadata.categories)?void 0:n.join(", "))||"");return t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h3",{children:"编辑元数据"}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"替代文本"}),t.jsx("input",{type:"text",value:i,onChange:e=>o(e.target.value)})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"分类 (逗号分隔)"}),t.jsx("input",{type:"text",value:d,onChange:e=>c(e.target.value)})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:s,children:"取消"}),t.jsx("button",{onClick:()=>l({...e,metadata:{...e.metadata,altText:i,categories:d.split(",").map(e=>e.trim()).filter(e=>e)}}),children:"保存"})]})]})})},i=({blob:e,isSelected:a,onSelect:s,onEdit:l})=>t.jsxs("div",{className:"image-card",children:[t.jsx("input",{type:"checkbox",checked:a,onChange:e=>s(e.target.checked)}),t.jsx("img",{src:e.url,alt:e.metadata.altText||""}),t.jsx("button",{onClick:l,children:"编辑"})]});export{s as default};
