import{c as e,j as a}from"./app-ebe47df9.js";import{r as t}from"./router-e246e4b3.js";import"./seo-d14d9378.js";import"./icons-7e3ded14.js";const s=()=>{const{t:s}=e("en"),[o,d]=t.useState([]),[r,c]=t.useState([]),[m,h]=t.useState(!1),[u,p]=t.useState(""),[x,j]=t.useState(0),[y,f]=t.useState(!1),[g,v]=t.useState(!1),[b,S]=t.useState(null),k=t.useCallback(async()=>{h(!0);try{const e=await fetch("/.netlify/functions/list-images"),a=await e.json();d(a.map(e=>({key:e.key,url:`/.netlify/functions/get-image?key=${e.key}`,metadata:e.metadata})))}catch(e){}finally{h(!1)}},[]);t.useEffect(()=>{k()},[k]);const C=o.filter(e=>{var a;return e.key.toLowerCase().includes(u.toLowerCase())||(null==(a=e.metadata.altText)?void 0:a.toLowerCase().includes(u.toLowerCase()))});return a.jsxs("div",{className:"admin-container",style:{marginTop:"200px"},children:[a.jsxs("header",{className:"admin-header",children:[a.jsx("h1",{children:s("admin.title")}),a.jsx("div",{className:"search-box",children:a.jsx("input",{type:"text",placeholder:s("admin.search_placeholder"),value:u,onChange:e=>p(e.target.value)})})]}),a.jsxs("section",{className:"upload-section",children:[a.jsx(n,{onDrop:async e=>{f(!0),j(0);try{const a=new FormData;Array.from(e).forEach(e=>{a.append("files",e)});const t=new XMLHttpRequest;t.upload.onprogress=e=>{e.lengthComputable&&j(Math.round(e.loaded/e.total*100))},await new Promise((e,s)=>{t.onload=()=>e(t.responseText),t.onerror=()=>s(new Error("Upload failed")),t.open("POST","/.netlify/functions/upload",!0),t.send(a)}),await k()}catch(a){}finally{f(!1),j(0)}},disabled:y}),y&&a.jsxs("div",{className:"upload-progress",children:[a.jsx("progress",{value:x,max:"100"}),a.jsxs("span",{children:[x,"%"]})]})]}),a.jsxs("div",{className:"action-toolbar",children:[a.jsx("button",{onClick:async()=>{if(r.length)try{await Promise.all(r.map(e=>fetch("/.netlify/functions/delete-image",{method:"POST",body:JSON.stringify({key:e}),headers:{"Content-Type":"application/json"}}))),c([]),await k()}catch(e){}},disabled:!r.length,children:s("admin.delete_selected")}),a.jsxs("span",{children:[r.length," ",s("admin.selected_items")]})]}),a.jsx("section",{className:"gallery-section",children:m?a.jsx("div",{className:"loading-indicator",children:s("admin.loading")}):a.jsx("div",{className:"image-grid",children:C.map(e=>a.jsx("div",{children:a.jsx(i,{blob:e,isSelected:r.includes(e.key),onSelect:a=>{c(t=>a?[...t,e.key]:t.filter(a=>a!==e.key))},onEdit:()=>(e=>{S(e),v(!0)})(e)})},e.key))})}),g&&b&&a.jsx(l,{blob:b,onClose:()=>v(!1),onSave:async e=>{try{await fetch("/.netlify/functions/update-metadata",{method:"POST",body:JSON.stringify({key:e.key,metadata:e.metadata}),headers:{"Content-Type":"application/json"}}),v(!1),await k()}catch(a){}}})]})},n=({onDrop:e,disabled:t})=>a.jsxs("div",{className:"file-dropzone",children:[a.jsx("input",{type:"file",multiple:!0,onChange:a=>a.target.files&&e(a.target.files),disabled:t}),a.jsx("p",{children:t?"上传中...":"拖放文件到这里或点击选择文件"})]}),l=({blob:e,onClose:s,onSave:n})=>{var l;const[i,o]=t.useState(e.metadata.altText||""),[d,r]=t.useState((null==(l=e.metadata.categories)?void 0:l.join(", "))||"");return a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content",children:[a.jsx("h3",{children:"编辑元数据"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"替代文本"}),a.jsx("input",{type:"text",value:i,onChange:e=>o(e.target.value)})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"分类 (逗号分隔)"}),a.jsx("input",{type:"text",value:d,onChange:e=>r(e.target.value)})]}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{onClick:s,children:"取消"}),a.jsx("button",{onClick:()=>n({...e,metadata:{...e.metadata,altText:i,categories:d.split(",").map(e=>e.trim()).filter(e=>e)}}),children:"保存"})]})]})})},i=({blob:e,isSelected:t,onSelect:s,onEdit:n})=>a.jsxs("div",{className:"image-card",children:[a.jsx("input",{type:"checkbox",checked:t,onChange:e=>s(e.target.checked)}),a.jsx("img",{src:e.url,alt:e.metadata.altText||""}),a.jsx("button",{onClick:n,children:"编辑"})]});export{s as default};
